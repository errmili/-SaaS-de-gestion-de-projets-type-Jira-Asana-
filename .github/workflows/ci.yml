# ==========================================
# SaaS CI - Version Simple (basÃ©e sur cinÃ©ma)
# Fichier: .github/workflows/ci.yml
# ==========================================

name: SaaS CI - Build Simple

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  # =================== JOB UNIQUE: BUILD SIMPLE ===================
  build-compile:
    runs-on: ubuntu-latest

    steps:
      # Ã‰tape 1: RÃ©cupÃ©rer le code
      - name: ðŸ“¥ RÃ©cupÃ©rer le code
        uses: actions/checkout@v3

      # Ã‰tape 2: Installer Java 17
      - name: â˜• Installer Java 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # Ã‰tape 3: Cache Maven
      - name: ðŸ“¦ Cache Maven
        uses: actions/cache@v3
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}

      # Ã‰tape 4: Build chaque service UN PAR UN
      - name: ðŸ”¨ Build Auth Service
        run: |
          echo "ðŸš€ Build du Auth Service..."
          cd auth-service
          mvn clean compile
          mvn test -DskipTests=false
          echo "âœ… Auth Service compilÃ© et testÃ©!"

      - name: ðŸ”¨ Build Project Service
        run: |
          echo "ðŸš€ Build du Project Service..."
          cd project-service
          mvn clean compile  
          mvn test -DskipTests=false
          echo "âœ… Project Service compilÃ© et testÃ©!"

      - name: ðŸ”¨ Build File Service
        run: |
          echo "ðŸš€ Build du File Service..."
          cd file-service
          mvn clean compile
          mvn test -DskipTests=false
          echo "âœ… File Service compilÃ© et testÃ©!"

      - name: ðŸ”¨ Build Notification Service
        run: |
          echo "ðŸš€ Build du Notification Service..."
          cd notification-service
          mvn clean compile
          mvn test -DskipTests=false
          echo "âœ… Notification Service compilÃ© et testÃ©!"

      - name: ðŸ”¨ Build Analytics Service
        run: |
          echo "ðŸš€ Build du Analytics Service..."
          cd analytics-service
          mvn clean compile
          mvn test -DskipTests=false
          echo "âœ… Analytics Service compilÃ© et testÃ©!"

      # Ã‰tape 5: Message de fin
      - name: ðŸŽ‰ Build terminÃ©
        run: |
          echo "ðŸŽ‰ Tous les services SaaS ont Ã©tÃ© compilÃ©s avec succÃ¨s!"
          echo "ðŸš€ Ton architecture microservices SaaS est prÃªte!"